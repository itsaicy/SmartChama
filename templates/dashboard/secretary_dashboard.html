{% extends 'dashboard/dashboard_base.html' %}
{% load humanize %}

{% block title %}Secretary Dashboard - {{ chama.chama_name }}{% endblock %}
{% block header %}Secretary Dashboard{% endblock %}

{# --- Topbar Search Block --- #}
{% block topbar %}
    {% if active_chama %}
    <form method="get" action="{% url 'dashboard:dashboard_search' active_chama.id %}" class="d-none d-md-block me-3">
        <div class="input-group search-bar bg-white rounded-pill px-3 py-1 shadow-sm">
            <span class="input-group-text border-0 bg-transparent p-0">
                <i class="fas fa-search text-muted small"></i>
            </span>
            <input type="text" name="q" class="form-control border-0 bg-transparent shadow-none small" placeholder="Search members...">
        </div>
    </form>
    {% endif %}
{% endblock %}

{% block content %}

<div class="row g-4 mb-4">
    <div class="col-md-6 col-lg-4">
        <div class="card-base d-flex align-items-center">
            <div class="icon-circle bg-light text-primary me-3">
                <i class="fas fa-users"></i>
            </div>
            <div>
                <small class="text-muted fw-bold text-uppercase">Total Members</small>
                <h3 class="fw-bold mb-0">{{ total_members }}</h3>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-lg-4">
        <div class="card-base d-flex align-items-center">
            <div class="icon-circle bg-light text-success me-3">
                <i class="fas fa-user-check"></i>
            </div>
            <div>
                <small class="text-muted fw-bold text-uppercase">Active Members</small>
                <h3 class="fw-bold mb-0">{{ active_members }}</h3>
            </div>
        </div>
    </div>

    <div class="col-md-12 col-lg-4">
        <div class="card-base d-flex align-items-center">
            <div class="icon-circle bg-light text-danger me-3">
                <i class="fas fa-user-times"></i>
            </div>
            <div>
                <small class="text-muted fw-bold text-uppercase">Inactive Members</small>
                <h3 class="fw-bold mb-0">{{ inactive_members }}</h3>
            </div>
        </div>
    </div>
</div>

<h6 class="text-muted fw-bold text-uppercase small mb-3">Attention Needed</h6>

<div class="row g-4 mb-4">
    <div class="col-lg-4 col-md-6">
        <div class="card-base card-attention border-blue">
            <small class="fw-bold text-primary">
                <i class="fas fa-user-plus me-1"></i> JOIN REQUESTS
            </small>
            <h2 class="fw-bold mt-2 mb-0">{{ join_requests.count|default:0 }}</h2>
            <small class="text-muted">Pending approvals</small>
        </div>
    </div>

    <div class="col-lg-4 col-md-6">
        <div class="card-base card-attention border-green">
            <small class="fw-bold text-success">
                <i class="fas fa-calendar-alt me-1"></i> UPCOMING MEETINGS
            </small>
            <h2 class="fw-bold mt-2 mb-0">{{ upcoming_meetings.count|default:0 }}</h2>
            <small class="text-muted">This week</small>
        </div>
    </div>

    <div class="col-lg-4 col-md-12">
        <div class="card-base card-attention border-purple">
            <small class="fw-bold text-purple">
                <i class="fas fa-user-clock me-1"></i> NEW MEMBERS
            </small>
            <h2 class="fw-bold mt-2 mb-0">{{ new_members_this_month }}</h2>
            <small class="text-muted">Joined in {{ now|date:"F" }}</small>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-lg-6">
        <div class="card-base">
            <h6 class="fw-bold mb-2">Average Attendance</h6>
            <h2 class="fw-bold text-success mb-2">
                {{ avg_attendance|floatformat:0 }}%
            </h2>
            <div class="progress" style="height:6px;">
                <div class="progress-bar bg-success"
                     role="progressbar"
                     style="width: {{ avg_attendance|default:0 }}%;"
                     aria-valuenow="{{ avg_attendance|default:0 }}" 
                     aria-valuemin="0" 
                     aria-valuemax="100">
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card-base">
            <h6 class="fw-bold mb-2">Active Member Ratio</h6>
            <h2 class="fw-bold text-primary mb-2">
                {{ active_percentage|floatformat:0 }}%
            </h2>
            <div class="progress" style="height:6px;">
                <div class="progress-bar bg-primary"
                     role="progressbar"
                     style="width: {{ active_percentage|default:0 }}%;"
                     aria-valuenow="{{ active_percentage|default:0 }}" 
                     aria-valuemin="0" 
                     aria-valuemax="100">
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}