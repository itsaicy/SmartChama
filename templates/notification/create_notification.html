{% extends 'notification/notification_base.html' %}
{% block title %}Create Notification{% endblock %}
{% block header_title %}Create Notification{% endblock %}

{% block content %}
<div class="d-flex justify-content-center">
  <form method="post" class="notif-card notif-centered js-create-notification-form" action="{% url 'notification:create_notification' chama.id %}">
    {% csrf_token %}
    <div class="mb-3">
      <label class="form-label small-muted">Title</label>
      <input name="title" class="form-control bg-transparent text-white" placeholder="Meeting Reminder" required>
    </div>

    <div class="mb-3">
      <label class="form-label small-muted">Message</label>
      <textarea name="message" class="form-control bg-transparent text-white" rows="6" placeholder="Enter your notification message here..." required></textarea>
    </div>

    <div class="d-flex gap-2 mb-3">
      <select name="notification_type" class="form-select form-select-sm bg-transparent text-white" style="min-width:160px;">
        <option value="announcement">Announcement</option>
        <option value="meeting">Meeting</option>
        <option value="reminder">Reminder</option>
        <option value="loan">Loan</option>
        <option value="payment">Payment</option>
      </select>

      <select name="priority" class="form-select form-select-sm bg-transparent text-white" style="min-width:120px;">
        <option value="normal">Normal</option>
        <option value="high">High</option>
        <option value="low">Low</option>
      </select>
    </div>

    <div class="mb-3">
      <button type="button" class="btn btn-outline-light js-open-members">Select Target Members</button>
      <span class="ms-3 small-muted js-member-count">Sending to all members</span>
    </div>

    <div class="d-flex justify-content-between mt-4">
      <a href="{% url 'notification:notification_list' %}" class="btn btn-light">Cancel</a>
      <button class="btn btn-warning text-dark fw-semibold" type="submit">Send</button>
    </div>
  </form>
</div>

<div class="modal fade js-members-modal" id="membersModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header border-0">
        <h5 class="modal-title fw-semibold">Select Members</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="list-group js-members-list">
          {% for m in members %}
            <label class="list-group-item d-flex justify-content-between align-items-center js-member-item">
              <div>
                <div class="fw-semibold">{{ m.membership_user.get_full_name|default:m.membership_user.username }}</div>
                <div class="small-muted">{{ m.membership_user.email }}</div>
              </div>
              <input type="checkbox" class="form-check-input" name="target_members" value="{{ m.id }}">
            </label>
          {% endfor %}
        </div>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/notification_form.js' %}" defer></script>
{% endblock %}
