{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container mt-5">
  <h2 class="mb-4 text-center fw-bold text-primary">My Chamas</h2>

  <!-- Search and Filter -->
  <div class="d-flex justify-content-between mb-3">
    <div class="input-group w-50">
      <span class="input-group-text"><i class="fas fa-search"></i></span>
      <input type="text" id="searchInput" class="form-control" placeholder="Search chama name...">
    </div>
    <div>
      <select id="filterStatus" class="form-select">
        <option value="">Filter by Status</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
      </select>
    </div>
  </div>

  <!-- Chama Table -->
  <div class="table-responsive">
    <table class="table table-hover table-striped align-middle">
      <thead class="table-primary">
        <tr>
          <th>#</th>
          <th>Chama Name</th>
          <th>Contribution</th>
          <th>Frequency</th>
          <th>Members</th>
          <th>Created On</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="chamaTable">
        {% for chama in chamas %}
        <tr data-status="{{ chama.status|lower }}">
          <td>{{ forloop.counter }}</td>
          <td>{{ chama.chama_name }}</td>
          <td>KSh {{ chama.chama_contribution_amount }}</td>
          <td>{{ chama.chama_contribution_frequency }}</td>
          <td>{{ chama.total_members }}</td>
          <td>{{ chama.chama_created_at|date:"Y-m-d" }}</td>
          <td>
            <span class="badge {% if chama.status == 'Active' %}bg-success{% else %}bg-secondary{% endif %}">
              {{ chama.status }}
            </span>
          </td>
          <td>
            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse" data-bs-target="#details{{ forloop.counter }}">
              <i class="fas fa-chevron-down"></i>
            </button>
          </td>
        </tr>

        <!-- Collapsible Details Row -->
        <tr class="collapse" id="details{{ forloop.counter }}">
          <td colspan="8">
            <div class="p-3 bg-light rounded">
              <strong>Description:</strong> {{ chama.chama_description }}<br>
              <strong>Created by:</strong> {{ chama.chama_created_by }}<br>
              <strong>Total Contributions:</strong> KSh {{ chama.total_contributions|default:"0" }}<br>
              <strong>Next Meeting:</strong> {{ chama.next_meeting|default:"Not scheduled" }}
            </div>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-center text-muted">No chamas found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- JavaScript for Search and Filter -->
<script>
document.getElementById('searchInput').addEventListener('keyup', function () {
  const query = this.value.toLowerCase();
  const rows = document.querySelectorAll('#chamaTable tr[data-status]');
  rows.forEach(row => {
    const name = row.cells[1].textContent.toLowerCase();
    row.style.display = name.includes(query) ? '' : 'none';
  });
});

document.getElementById('filterStatus').addEventListener('change', function () {
  const filter = this.value;
  const rows = document.querySelectorAll('#chamaTable tr[data-status]');
  rows.forEach(row => {
    const status = row.getAttribute('data-status');
    row.style.display = !filter || status === filter ? '' : 'none';
  });
});
</script>
{% endblock %}
